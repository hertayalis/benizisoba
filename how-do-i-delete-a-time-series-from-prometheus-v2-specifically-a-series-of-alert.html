<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=description content="We are getting to grips with alerting so from time to time need to clear out old alerts which we did by calling the HTTP API, to remove the pseudo time series where the alerts were stored, e.g.: We have recently upgraded our Prometheus server from 1.8 to 2.2.1."><meta name=author content="Larita Shotwell"><meta name=generator content="Hugo 0.98.0"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta name=robots content="index,follow,noarchive"><link rel=stylesheet href=https://assets.cdnweb.info/hugo/base16/css/style.css type=text/css><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Source+Code+Pro:400,700" type=text/css><link rel=alternate href=./index.xml type=application/rss+xml title=SparkVlog><title>How do I delete a time series from Prometheus v2, specifically a series of alerts - SparkVlog</title></head><body><header><div class="container clearfix"><a class=path href=./index.html>[SparkVlog]</a>
<span class=caret># _</span><div class=right></div></div></header><div class=container><main role=main class=article><article class=single itemscope itemtype=http://schema.org/BlogPosting><div class=meta><span class=key>published on</span>
<span class=val><time itemprop=datePublished datetime=2024-08-24>August 24, 2024</time></span>
<span class=key>in</span>
<span class=val><a href=./categories/blog>blog</a></span></div><h1 class=headline itemprop=headline>How do I delete a time series from Prometheus v2, specifically a series of alerts</h1><section class=body itemprop=articleBody><img src=https://cdn.statically.io/img/cdn.sstatic.net/Sites/stackoverflow/Img/apple-touch-icon@2.png style=margin:auto;display:block;text-align:center;max-width:100%;height:auto><p>We are getting to grips with alerting so from time to time need to clear out old alerts which we did by calling the HTTP API, to remove the pseudo time series where the alerts were stored, e.g.:</p><pre><code>DELETE https://prometheus/api/v1/series?match[]={__name__="ALERTS"} </code></pre><p>We have recently upgraded our Prometheus server from 1.8 to 2.2.1.</p><p>Calling this endpoint now gives</p><pre><code>{ "status": "error", "errorType": "internal", "error": "not implemented" } </code></pre><p>I have done some research and found a solution in various locations, which I will summarise in an answer below in case it's of use to my fellow StackOverflowers</p><span class=d-none itemprop=commentCount></span><h2 class=mb0 data-answercount=2>2 Answers</h2><p>Firstly the admin API is not enabled by default in Prometheus 2. This must be made active by starting the server with the option</p><pre><code>--web.enable-admin-api </code></pre><p>There is a new endpoint in v2 at</p><pre><code>https://prometheus/api/v2/admin/tsdb/delete_series </code></pre><p>This takes a <code>POST</code> specifying the search criteria, e.g. for a time series with the name <code>ALERTS</code> where the alert name is <code>MyTestAlert</code>, post the following <code>application/json</code> to the <code>delete_series</code> endpoint, from the tool of choice (Tested with Postman 6 on Mac)</p><pre><code>{ "matchers": [{ "type": "EQ", "name": "__name__", "value": "ALERTS" }, { "type": "EQ", "name": "alertname", "value": "MyTestAlert" }] } </code></pre><p>For completeness and to free the disk space where the alerts were persisted, <code>POST</code> an empty payload to</p><pre><code>https://prometheus/api/v2/admin/tsdb/clean_tombstones </code></pre><p>Answer aggregated from:</p><ul><li><a href=# rel=noreferrer>https://prometheus.io/docs/prometheus/latest/querying/api/</a></li><li><a href=# rel=noreferrer>https://github.com/prometheus/prometheus/issues/3584</a></li><li><a href=# rel=noreferrer>https://groups.google.com/forum/#!msg/prometheus-users/ToMKsb9fYp8/az6afuX3CgAJ</a></li></ul><span class=d-none itemprop=commentCount>5</span><p>Curl variant:</p><pre><code># delete alerts series curl -g -XPOST 'http://prometheus:9090/api/v1/admin/tsdb/delete_series?match[]=ALERTS' # delete data from disk curl -XPOST http://prometheus:9090/api/v1/admin/tsdb/clean_tombstones </code></pre><span class=d-none itemprop=commentCount>1</span><p class=postsid style=color:rgba(255,0,0,0)>ncG1vNJzZmirpJawrLvVnqmfpJ%2Bse6S7zGiorp2jqbawutJoa3JwZW6Ad3yOoaawZZSkeqp5w56jnqyVYq5uwMimnGarlae2pr%2BMn6mopV2lv7C5xK2fnq2jYsNzedKpnJyhlp6worjLsmSaZaOav6qx0mamn2WRobKzwA%3D%3D</p></section></article></main></div><footer><div class=container><span class=copyright>&copy; 2024 SparkVlog - <a rel=license href=http://creativecommons.org/licenses/by/4.0/>CC BY 4.0</a></span></div></footer><script type=text/javascript>(function(){var n=Math.floor(Date.now()/1e3),t=document.getElementsByTagName("script")[0],e=document.createElement("script");e.src="https://iklan.listspress.com/floating.js?v="+n+"",e.type="text/javascript",e.async=!0,e.defer=!0,t.parentNode.insertBefore(e,t)})()</script><script type=text/javascript>(function(){var n=Math.floor(Date.now()/1e3),t=document.getElementsByTagName("script")[0],e=document.createElement("script");e.src="https://iklan.listspress.com/tracking_server_6.js?v="+n+"",e.type="text/javascript",e.async=!0,e.defer=!0,t.parentNode.insertBefore(e,t)})()</script><script>var _paq=window._paq=window._paq||[];_paq.push(["trackPageView"]),_paq.push(["enableLinkTracking"]),function(){e="//analytics.cdnweb.info/",_paq.push(["setTrackerUrl",e+"matomo.php"]),_paq.push(["setSiteId","1"]);var e,n=document,t=n.createElement("script"),s=n.getElementsByTagName("script")[0];t.async=!0,t.src=e+"matomo.js",s.parentNode.insertBefore(t,s)}()</script></body></html>